\section{Design of a policy matching algorithm for generating data-sharing agreements}
\label{sec:algorithm}

% TODO: add introduction

% Table comparing features of OAC with existing Solid solutions + solutions in SotA ?
% Offer, Request, Agreement
% Data, Access, Purpose, Legal Basis

\subsection{Data subject policies as \texttt{odrl:Offer}s}
\label{sec:algorithm-offer}

Data subjects can express policies for specific resources, containers of resources, specific personal data types, or even for data they have not produced yet.
As such, at the time of instantiation, the incoming data request should be used to filter the data subject's policies that apply to that particular request.
Therefore, the resulting \texttt{odrl:Offer} instance contains the union of all pertinent user policies, which can be used to match against incoming data requests in order to generate data access agreements for certain resources or data.
Furthermore, this policy can be used as metadata that accompanies the data being shared, so that data controllers can keep a copy of the conditions under which they can use the data.
In essence, such a system improves trust and accountability in decentralised data-sharing ecosystems as the policy can travel with the data, with provenance information on who generated the data, who generated the policy, and who attached it to the data.
Even though malicious agents can perform prohibited actions, such as making copies of data when only read-access to data was allowed, with the documentation of access conditions on the datastore of the data subject, he, she, or they can use these policies and metadata to file a complaint in the court of law for data misuse.
Moreover, when formulating offers, each distinct rule merged into the policy is preserved as an individual rule to facilitate the matching with data requests.
This preservation of individual rules also enables their individual annotation with provenance metadata, e.g., their origin or whether they are negotiable or non-negotiable rules.

Taking this into consideration, the instantiation of the \texttt{odrl:Offer} should follow the subsequent algorithm:
\begin{enumerate}
    \item For a given personal datastore, retrieve all user preferences and requirements recorded in a datastore policy registry.
    \item Filter out duplicated policies.
    \item Filter out policies that do not match with any terms of the data request.
    \item For each retrieved policy, fetch relevant \texttt{odrl:Permission} and \texttt{odrl:Prohibition} rules and merge them in a single \texttt{odrl:Offer}.
    \item Permissions and/or prohibitions associated with an OAC requirement or an OAC preference should be associated with the term \texttt{dpv:Required}, in case said rule is a requirement, or the term \texttt{dpv:Optional}, in case it is a preference, using the \texttt{dpv:hasContext} property.
    \item A link to each `original' policy is maintained in the final \texttt{odrl:Offer} by using the \texttt{dcterms:source} property.
    \item Add provenance information to the \texttt{odrl:Offer}, e.g. \texttt{dcterms:issued} for when the offer was instantiated and \texttt{dcterms:creator} for the issuer of the policy.
\end{enumerate}

The previously represented Listing~\ref{list:oac_offer} presents an example of a result of the offer instantiation algorithm, generated from two existing, relevant policies, as indicated by the \texttt{dcterms:source} property, based on an OAC requirement and OAC preference policies, as expressed by the \texttt{dpv:hasContext} property.

\subsection{Development of an OAC policy editor}
\label{sec:sope}

This Section features an ODRL editor designed to define and save RDF policies, to enable the granting of access to personal data stored in Solid Pods.
RDF policies are articulated using the OAC specification developed in Section~\ref{sec:oac}.
As such, with such an OAC editor, data subjects can create intricate, detailed policies that adhere to GDPR stipulations concerning personal data processing without the burden of knowing ODRL or even RDF.

\paragraph{SOPE -- the Solid ODRL access control Policies Editor}
SOPE is a Solid-based app for data subjects to define and store ODRL policies, based on the OAC specification, on Solid Pods.
Detailed instructions on how to install, launch, and use the app are available on the source code repository\footnote{\url{https://w3id.org/people/besteves/sope/repo}}.
To use it, data subjects must already be in the possession of a Solid Pod and a WebID to be able to log into their Pod and store policies there, using SOPE.
Once logged in, users can select the type of policy they want to model, as well as choose the types of personal data and purposes to which the policy applies.
Additionally, users can also select what type of access they which to provide for said data type and purpose, as well as model further constraints, such as types of recipients that can receive the results of the personal data processing or identity providers used by data requesters to authenticate.
Finally, the prototype interface allows users to generate and store the ODRL policy's RDF in the Pod, without the need for users to be knowledgeable about OAC, ODRL, or DPV.
SOPE also stores policy logs and updates the policy registry in the user's Pod, using the PLASMA vocabulary to model such information, however, in the future, such documentation should be generated by the server to ensure interoperability (by not depending on the app's own implementation, which could diverge from app to app).
All generated information, e.g., policies, logs, and registry, is stored in a private location within the Pod -- only authorised users, apps, or services will have access to it if desired by the data subject.
\beatriz{Figure XX } presents a screenshot of SOPE's interface.

\paragraph{SOPE's coverage, maintenance, and future work}
SOPE's source code is hosted at \url{https://w3id.org/people/besteves/sope/repo}, under the CC-BY-4.0 license.
The repository can also be used by SOPE users to suggest new features to be added to the app and to report bugs through GitHub Issues.
\beatriz{Table XX } illustrates the current coverage of SOPE concerning the terms implemented in the app from DPV's taxonomies of purposes, personal data categories, processing operations, and recipients.
As future work, SOPE can be extended to include all terms present in the previously mentioned DPV's taxonomies, as well as to cover all constraints defined in the OAC profile, e.g., restrict legal bases or specify the technical and organisational measures used by data controllers to ensure the secure processing of personal data.
Moreover, with such an extension, SOPE could also be used by data controllers to detail their privacy policies.
Additionally, user studies should be performed to assess the design choices included in the editor, as well as to understand what type of additional controls people want to have on top of what is legally mandated, e.g., temporal constraints or duties for the data controller to fulfil prior to the data access.


% Add sentence on maintenance and future development, as well as FAIR practices for code repos